generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Guest {
  id                  String   @id @default(uuid())
  name                String
  code                String   @unique
  role                String   @default("GUEST")
  diet                String?
  dietaryRestrictions String?
  songRequest         String?
  tableNumber         String?
  phone               String?
  email               String?
  invitedById         String?
  maxInvites          Int      @default(0)
  rsvpMain            Boolean  @default(false)
  rsvpDinner          Boolean  @default(false)
  rsvpAfterParty      Boolean  @default(false)
  plusOneAllowed      Boolean  @default(true)
  plusOneName         String?
  plusOneDiet         String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  invitedBy           Guest?   @relation("Invites", fields: [invitedById], references: [id], onDelete: Cascade)
  invitees            Guest[]  @relation("Invites")
}

model EventSettings {
  id                    String   @id @default("default")
  date                  DateTime
  title                 String   @default("The Main Event")
  locationName          String
  locationAddress       String?
  vibe                  String
  isRsvpLocked          Boolean  @default(false)
  isDietEnabled         Boolean  @default(true)
  dietTargetRoles       String   @default("")
  isSongRequestEnabled  Boolean  @default(true)
  songTargetRoles       String   @default("")
  dinnerTitle           String   @default("Private Dinner")
  dinnerDescription     String   @default("Please confirm if you will join us for the family dinner before the main event.")
  afterPartyTitle       String   @default("The Afterparty")
  afterPartyDescription String   @default("Music & Drinks")
  updatedAt             DateTime @updatedAt
}

model TimelineItem {
  id          String   @id @default(uuid())
  time        String
  title       String
  description String?
  order       Int      @default(0)
  visibleTo   String   @default("ALL")
  updatedAt   DateTime @updatedAt
}

model Event {
  id              String     @id @default(uuid())
  title           String
  date            DateTime
  time            String?
  locationName    String?
  locationAddress String?
  description     String?
  order           Int        @default(0)
  visibleToRoles  String     @default("ALL")
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  subEvents       SubEvent[]
}

model SubEvent {
  id             String    @id @default(uuid())
  eventId        String
  title          String
  date           DateTime?
  time           String?
  description    String?
  order          Int       @default(0)
  visibleToRoles String    @default("ALL")
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  event          Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
}
